/**
 * ðŸ›‘ DO NOT EDIT THIS FILE DIRECTLY
 * ----------------------------------
 * This file was generated by ISL Compiler.
 * Source: ui.isl.md
 * Edit the ISL file instead.
 */

import React from 'react';
import { IconSize } from './domain'; // IconSize is a named export from domain

// Helper for Tailwind dynamic grid columns
// Tailwind JIT/AOT compilation requires explicit class names.
// Dynamic class names like `grid-cols-${size}` might not be generated if not present in source.
// For production, it's safer to use a fixed set of classes or inline styles for gridTemplateColumns.
// Given the constraint to use TailwindCSS, and the common practice for dynamic grids,
// we'll use inline styles for `gridTemplateColumns` and a generic `grid` class.
// The `getGridColsClass` helper is removed as it's not strictly necessary with inline `gridTemplateColumns`.

/**
 * DrawingCanvas Component
 * Displays a square grid of cells, each representing a pixel.
 */
export default function DrawingCanvas({ grid = [], cellSize = 16, onPixelClick = () => {} }) {
  const gridDimension = grid.length;
  const canvasSize = gridDimension * cellSize;

  // Ensure grid is valid before rendering
  if (!Array.isArray(grid) || gridDimension === 0 || !Array.isArray(grid[0])) {
    // Provide a fallback UI for invalid grid data
    return (
      <div
        className="border border-gray-300 shadow-inner bg-gray-100 flex items-center justify-center text-gray-500"
        style={{ width: `${canvasSize || 160}px`, height: `${canvasSize || 160}px` }}
      >
        No grid data available.
      </div>
    );
  }

  // Capability: handleCellClick
  const handleCellClick = (x, y) => {
    onPixelClick(x, y);
  };

  return (
    <div
      className="border border-gray-300 shadow-inner overflow-hidden"
      style={{ width: `${canvasSize}px`, height: `${canvasSize}px` }}
    >
      <div
        className="grid w-full h-full"
        style={{
          gridTemplateColumns: `repeat(${gridDimension}, minmax(0, 1fr))`,
          gridTemplateRows: `repeat(${gridDimension}, minmax(0, 1fr))`,
        }}
      >
        {grid.map((row, y) =>
          row.map((cell, x) => (
            <div
              key={`${x}-${y}`}
              className="border border-gray-200 cursor-pointer"
              style={{
                backgroundColor: cell?.color || 'transparent', // Use safe access and default
                width: `${cellSize}px`,
                height: `${cellSize}px`,
              }}
              onClick={() => handleCellClick(x, y)}
              aria-label={`Pixel at ${x}, ${y} with color ${cell?.color || 'transparent'}`}
            />
          ))
        )}
      </div>
    </div>
  );
}

/**
 * IconPreview Component
 * Displays a smaller, scaled-down version of the icon grid.
 */
export function IconPreview({ grid = [], previewSize = 64 }) {
  const gridDimension = grid.length;

  // Ensure grid is valid before rendering
  if (!Array.isArray(grid) || gridDimension === 0 || !Array.isArray(grid[0])) {
    // Provide a fallback UI for invalid grid data
    return (
      <div
        className="border border-gray-300 shadow-md bg-gray-100 flex items-center justify-center text-gray-500"
        style={{ width: `${previewSize}px`, height: `${previewSize}px` }}
      >
        No preview.
      </div>
    );
  }

  const cellPixelSize = previewSize / gridDimension;

  return (
    <div
      className="border border-gray-300 shadow-md overflow-hidden"
      style={{ width: `${previewSize}px`, height: `${previewSize}px` }}
    >
      <div
        className="grid w-full h-full"
        style={{
          gridTemplateColumns: `repeat(${gridDimension}, minmax(0, 1fr))`,
          gridTemplateRows: `repeat(${gridDimension}, minmax(0, 1fr))`,
        }}
      >
        {grid.map((row, y) =>
          row.map((cell, x) => (
            <div
              key={`${x}-${y}`}
              className="relative" // Use relative for potential future styling, but here just for structure
              style={{
                backgroundColor: cell?.color || 'transparent', // Use safe access and default
                width: `${cellPixelSize}px`,
                height: `${cellPixelSize}px`,
              }}
              aria-label={`Preview pixel at ${x}, ${y} with color ${cell?.color || 'transparent'}`}
            />
          ))
        )}
      </div>
    </div>
  );
}

/**
 * SizeSelector Component
 * Provides a user interface element to choose an IconSize.
 */
export function SizeSelector({ currentSize = IconSize.SIZE_16, onSizeChange = () => {} }) {
  const sizes = [IconSize.SIZE_16, IconSize.SIZE_32, IconSize.SIZE_64];

  // Capability: handleSizeSelection
  const handleSizeSelection = (event) => {
    const selectedSize = parseInt(event.target.value, 10);
    onSizeChange(selectedSize);
  };

  return (
    <div className="flex items-center space-x-4">
      <label htmlFor="size-selector" className="text-sm font-medium text-gray-700">
        Grid Size:
      </label>
      <select
        id="size-selector"
        className="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"
        value={currentSize}
        onChange={handleSizeSelection}
      >
        {sizes.map((size) => (
          <option key={size} value={size}>
            {`${size}x${size}`}
          </option>
        ))}
      </select>
    </div>
  );
}

/**
 * ColorPicker Component
 * Displays a color input element.
 */
export function ColorPicker({ currentColor = '#000000', onColorChange = () => {} }) {
  // Capability: handleColorInput
  const handleColorInput = (event) => {
    const selectedColor = event.target.value;
    onColorChange(selectedColor);
  };

  return (
    <div className="flex items-center space-x-4">
      <label htmlFor="color-picker" className="text-sm font-medium text-gray-700">
        Drawing Color:
      </label>
      <input
        type="color"
        id="color-picker"
        className="h-10 w-10 border border-gray-300 rounded-md cursor-pointer"
        value={currentColor}
        onChange={handleColorInput}
        aria-label="Select drawing color"
      />
    </div>
  );
}

/**
 * Toolbar Component
 * Displays a button labeled "Clear Grid".
 */
export function Toolbar({ onClear = () => {} }) {
  // Capability: handleClearClick
  const handleClearClick = () => {
    onClear();
  };

  return (
    <div>
      <button
        type="button"
        className="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"
        onClick={handleClearClick}
      >
        Clear Grid
      </button>
    </div>
  );
}