/**
 * ðŸ›‘ DO NOT EDIT THIS FILE DIRECTLY
 * ----------------------------------
 * This file was generated by ISL Compiler.
 * Source: kanban-ui.isl.md
 * Edit the ISL file instead.
 */

import React, { useState, useCallback } from 'react';
import { PriorityType, TaskEntity, ColumnEntity, BoardEntity } from "./domain";

// Tailwind classes for basic styling
const commonInputClasses = "p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500";
const commonButtonClasses = "px-4 py-2 rounded-md text-white font-semibold transition-colors duration-200";
const primaryButtonClasses = `${commonButtonClasses} bg-blue-600 hover:bg-blue-700`;
const dangerButtonClasses = `${commonButtonClasses} bg-red-600 hover:bg-red-700`;
const secondaryButtonClasses = `${commonButtonClasses} bg-gray-500 hover:bg-gray-600`;
const disabledButtonClasses = `${commonButtonClasses} bg-gray-300 cursor-not-allowed`;

/**
 * @typedef {object} TaskDetails
 * @property {string} title
 * @property {string} description
 * @property {string} dueDate
 * @property {typeof PriorityType[keyof typeof PriorityType]} priority
 */

/**
 * @typedef {object} UpdatedTaskDetails
 * @property {string} [title]
 * @property {string} [description]
 * @property {string} [dueDate]
 * @property {typeof PriorityType[keyof typeof PriorityType]} [priority]
 */

/**
 * Component: CreateColumnFormView
 * Role: Presentation
 * Signature: onSubmit: function(title: string)
 */
const CreateColumnFormView = ({ onSubmit }) => {
  const [columnTitle, setColumnTitle] = useState('');

  const handleSubmit = useCallback((e) => {
    e.preventDefault();
    if (columnTitle.trim()) {
      onSubmit(columnTitle.trim());
      setColumnTitle('');
    }
  }, [columnTitle, onSubmit]);

  return (
    <form onSubmit={handleSubmit} className="p-4 bg-gray-100 rounded-lg shadow-md flex gap-2 items-center">
      <input
        type="text"
        placeholder="Column Title"
        value={columnTitle}
        onChange={(e) => setColumnTitle(e.target.value)}
        className={`${commonInputClasses} flex-grow`}
        aria-label="Column Title"
      />
      <button type="submit" className={primaryButtonClasses}>
        Add Column
      </button>
    </form>
  );
};

/**
 * Component: CreateTaskFormView
 * Role: Presentation
 * Signature: columnId: UUID, onSubmit: function(columnId: UUID, task: TaskDetails)
 */
const CreateTaskFormView = ({ columnId, onSubmit }) => {
  const [taskTitle, setTaskTitle] = useState('');
  const [description, setDescription] = useState('');
  const [dueDate, setDueDate] = useState('');
  const [priority, setPriority] = useState(PriorityType.LOW);

  const handleSubmit = useCallback((e) => {
    e.preventDefault();
    if (taskTitle.trim()) {
      onSubmit(columnId, {
        title: taskTitle.trim(),
        description: description.trim(),
        dueDate: dueDate.trim(),
        priority: priority,
      });
      setTaskTitle('');
      setDescription('');
      setDueDate('');
      setPriority(PriorityType.LOW);
    }
  }, [columnId, onSubmit, taskTitle, description, dueDate, priority]);

  return (
    <form onSubmit={handleSubmit} className="p-4 bg-white rounded-lg shadow-sm flex flex-col gap-3">
      <input
        type="text"
        placeholder="Task Title"
        value={taskTitle}
        onChange={(e) => setTaskTitle(e.target.value)}
        className={commonInputClasses}
        aria-label="Task Title"
      />
      <textarea
        placeholder="Description"
        value={description}
        onChange={(e) => setDescription(e.target.value)}
        className={`${commonInputClasses} h-20 resize-y`}
        aria-label="Description"
      ></textarea>
      <input
        type="date"
        placeholder="Due Date (YYYY-MM-DD)"
        value={dueDate}
        onChange={(e) => setDueDate(e.target.value)}
        className={commonInputClasses}
        aria-label="Due Date"
      />
      <select
        value={priority}
        onChange={(e) => setPriority(e.target.value)}
        className={commonInputClasses}
        aria-label="Priority"
      >
        {Object.values(PriorityType).map((p) => (
          <option key={p} value={p}>{p}</option>
        ))}
      </select>
      <button type="submit" className={primaryButtonClasses}>
        Add Task
      </button>
    </form>
  );
};

/**
 * Component: TaskView
 * Role: Presentation
 * Signature: task: TaskEntity, onUpdateTask: function(columnId: UUID, taskId: UUID, updatedDetails: UpdatedTaskDetails), onDeleteTask: function(columnId: UUID, taskId: UUID), onMoveTask: function(currentColumnId: UUID, taskId: UUID, direction: 'left' | 'right'), columnId: UUID, isFirstColumn: boolean, isLastColumn: boolean
 */
const TaskView = ({
  task,
  onUpdateTask,
  onDeleteTask,
  onMoveTask,
  columnId,
  isFirstColumn,
  isLastColumn,
}) => {
  const handleEdit = useCallback(() => {
    // As per ISL, TaskView triggers onUpdateTask. It doesn't manage the edit form itself.
    // We pass an empty object for updatedDetails, assuming a parent component will handle the actual editing UI.
    onUpdateTask(columnId, task.id, {}); // Trigger edit, parent handles details
  }, [columnId, task.id, onUpdateTask]);

  const handleDelete = useCallback(() => {
    onDeleteTask(columnId, task.id);
  }, [columnId, task.id, onDeleteTask]);

  const handleMoveLeft = useCallback(() => {
    onMoveTask(columnId, task.id, 'left');
  }, [columnId, task.id, onMoveTask]);

  const handleMoveRight = useCallback(() => {
    onMoveTask(columnId, task.id, 'right');
  }, [columnId, task.id, onMoveTask]);

  return (
    <div className="bg-white p-4 rounded-lg shadow-md mb-3 border-l-4 border-blue-400">
      <h4 className="font-bold text-lg mb-1">{task.title}</h4>
      {task.description && <p className="text-gray-700 text-sm mb-2">{task.description}</p>}
      {task.dueDate && <p className="text-gray-600 text-xs mb-2">Due: {task.dueDate}</p>}
      <p className={`text-xs font-semibold ${
        task.priority === PriorityType.HIGH ? 'text-red-600' :
        task.priority === PriorityType.MEDIUM ? 'text-yellow-600' :
        'text-green-600'
      }`}>Priority: {task.priority}</p>
      <div className="flex flex-wrap gap-2 mt-3">
        <button onClick={handleEdit} className={secondaryButtonClasses}>
          Edit Task
        </button>
        <button onClick={handleDelete} className={dangerButtonClasses}>
          Delete Task
        </button>
        <button
          onClick={handleMoveLeft}
          disabled={isFirstColumn}
          className={isFirstColumn ? disabledButtonClasses : secondaryButtonClasses}
        >
          Move Left
        </button>
        <button
          onClick={handleMoveRight}
          disabled={isLastColumn}
          className={isLastColumn ? disabledButtonClasses : secondaryButtonClasses}
        >
          Move Right
        </button>
      </div>
    </div>
  );
};

/**
 * Component: ColumnView
 * Role: Presentation
 * Signature: column: ColumnEntity, onRenameColumn: function(columnId: UUID, newTitle: string), onDeleteColumn: function(columnId: UUID), onAddTask: function(columnId: UUID, taskDetails: TaskDetails), onUpdateTask: function(columnId: UUID, taskId: UUID, updatedDetails: UpdatedTaskDetails), onDeleteTask: function(columnId: UUID, taskId: UUID), onMoveTask: function(currentColumnId: UUID, taskId: UUID, direction: 'left' | 'right'), isFirstColumn: boolean, isLastColumn: boolean
 */
const ColumnView = ({
  column,
  onRenameColumn,
  onDeleteColumn,
  onAddTask,
  onUpdateTask,
  onDeleteTask,
  onMoveTask,
  isFirstColumn,
  isLastColumn,
}) => {
  const handleRename = useCallback(() => {
    const newTitle = prompt('Enter new column title:', column.title);
    if (newTitle != null && newTitle.trim() !== '') {
      onRenameColumn(column.id, newTitle.trim());
    }
  }, [column.id, column.title, onRenameColumn]);

  const handleDelete = useCallback(() => {
    if (confirm(`Are you sure you want to delete column "${column.title}"?`)) {
      onDeleteColumn(column.id);
    }
  }, [column.id, column.title, onDeleteColumn]);

  const handleAddTaskSubmit = useCallback((colId, taskDetails) => {
    onAddTask(colId, taskDetails);
  }, [onAddTask]);

  return (
    <div className="flex-shrink-0 w-80 bg-gray-200 p-4 rounded-lg shadow-lg flex flex-col gap-4">
      <div className="flex justify-between items-center mb-2">
        <h3 className="font-bold text-xl text-gray-800">{column.title}</h3>
        <div className="flex gap-2">
          <button onClick={handleRename} className={`${secondaryButtonClasses} !px-2 !py-1 text-sm`}>
            Rename
          </button>
          <button onClick={handleDelete} className={`${dangerButtonClasses} !px-2 !py-1 text-sm`}>
            Delete
          </button>
        </div>
      </div>
      <CreateTaskFormView columnId={column.id} onSubmit={handleAddTaskSubmit} />
      <div className="flex-grow overflow-y-auto pr-2 -mr-2">
        {column.tasks.map((task) => (
          <TaskView
            key={task.id}
            task={task}
            onUpdateTask={onUpdateTask}
            onDeleteTask={onDeleteTask}
            onMoveTask={onMoveTask}
            columnId={column.id}
            isFirstColumn={isFirstColumn}
            isLastColumn={isLastColumn}
          />
        ))}
      </div>
    </div>
  );
};

/**
 * Component: KanbanBoardView
 * Role: Presentation
 * Signature: board: BoardEntity, onAddColumn: function(title: string), onRenameColumn: function(columnId: UUID, newTitle: string), onDeleteColumn: function(columnId: UUID), onAddTask: function(columnId: UUID, taskDetails: TaskDetails), onUpdateTask: function(columnId: UUID, taskId: UUID, updatedDetails: UpdatedTaskDetails), onDeleteTask: function(columnId: UUID, taskId: UUID), onMoveTask: function(currentColumnId: UUID, taskId: UUID, direction: 'left' | 'right')
 */
const KanbanBoardView = ({
  board,
  onAddColumn,
  onRenameColumn,
  onDeleteColumn,
  onAddTask,
  onUpdateTask,
  onDeleteTask,
  onMoveTask,
}) => {
  const handleAddColumnSubmit = useCallback((title) => {
    onAddColumn(title);
  }, [onAddColumn]);

  // Ensure board and board.columns are not null/undefined
  const columns = board?.columns || [];

  return (
    <div className="p-6 bg-gray-50 min-h-screen flex flex-col gap-6">
      <h1 className="text-3xl font-extrabold text-gray-900 mb-4">Kanban Board</h1>
      <CreateColumnFormView onSubmit={handleAddColumnSubmit} />
      <div className="flex gap-6 overflow-x-auto pb-4">
        {columns.length > 0 ? (
          columns.map((column, index) => (
            <ColumnView
              key={column.id}
              column={column}
              onRenameColumn={onRenameColumn}
              onDeleteColumn={onDeleteColumn}
              onAddTask={onAddTask}
              onUpdateTask={onUpdateTask}
              onDeleteTask={onDeleteTask}
              onMoveTask={onMoveTask}
              isFirstColumn={index === 0}
              isLastColumn={index === columns.length - 1}
            />
          ))
        ) : (
          <p className="text-gray-600 italic">No columns yet. Add one above!</p>
        )}
      </div>
    </div>
  );
};

export default KanbanBoardView;